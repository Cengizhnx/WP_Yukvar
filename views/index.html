<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.1/font/bootstrap-icons.min.css"
    />
    <link rel="stylesheet" href="style.css" />
    <title>YÃ¼kvar</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/locale/tr.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  </head>
  <body>
    <section>
      <div
        class="container d-flex flex-column align-items-center justify-content-center mt-5 gap-3"
      >
        <h1>YÃ¼kvar</h1>
        <input
          type="text"
          class="form-control fixed-input"
          id="searchInput"
          aria-describedby="searchText"
          placeholder="Arama yapÄ±n..."
        />

        <!-- Messages counts -->
        <p class="m-auto order-1 order-md-0">
          <span class="fw-semibold" id="selectFilter"></span> SonuÃ§lar:
          <span id="totalMessagesCount">0</span>
        </p>
        <!-- Option List -->
        <select
          class="form-select filter-select m-auto order-0 order-md-1"
          aria-label="Filtrele"
          id="filterDropdown"
        >
          <option value="hepsi">Hepsi</option>
          <option value="Ä°ran">Ä°ran</option>
          <option value="Rusya">Rusya</option>
          <option value="Azerbaycan">Azerbaycan</option>
          <option value="TÃ¼rkmenistan">TÃ¼rkmenistan</option>
          <option value="GÃ¼rcistan">GÃ¼rcistan</option>
          <option value="Ä°srail">Ä°srail</option>
          <option value="Ã‡in">Ã‡in</option>
          <option value="Japonya">Japonya</option>
          <option value="Pakistan">Pakistan</option>
          <option value="Tunus">Tunus</option>
          <option value="ÃœrdÃ¼n">ÃœrdÃ¼n</option>
          <option value="Kuveyt">Kuveyt</option>
          <option value="Suudi Arabistan">Suudi Arabistan</option>
          <option value="Dubai">Dubai</option>
          <option value="Katar">Katar</option>
          <option value="Fas">Fas</option>
          <option value="MÄ±sÄ±rr">MÄ±sÄ±r</option>
          <option value="Yemen">Yemen</option>
          <option value="Danimarka">Danimarka</option>
          <option value="Macaristan">Macaristan</option>
          <option value="Portekiz">Portekiz</option>
          <option value="Ä°talya">Ä°talya</option>
          <option value="BelÃ§ika">BelÃ§ika</option>
          <option value="Ä°spanya">Ä°spanya</option>
          <option value="Fransa">Fransa</option>
          <option value="Almanya">Almanya</option>
          <option value="Romanya">Romanya</option>
          <option value="Arnavutluk">Arnavutluk</option>
          <option value="Bulgaristan">Bulgaristan</option>
        </select>
      </div>
    </section>

    <section>
      <div class="container my-3">
        <div
          class="d-flex col-12 flex-column flex-md-row align-items-start justify-content-between"
        >
          <!-- Buttons 1 -->
          <div
            class="col-12 col-md-3 d-flex align-items-center justify-content-center"
          >
            <div
              class="flex-wrap justify-content-center col-12 gap-3 filter-buttons"
            >
              <button
                type="button"
                value="hepsi"
                data-value="Hepsi"
                class="btn btn-primary"
              >
                Hepsi
              </button>
              <button
                type="button"
                value="Ä°ran"
                data-value="ðŸ‡®ðŸ‡·"
                class="btn btn-secondary"
              >
                Ä°ran
              </button>
              <button
                type="button"
                value="Rusya"
                data-value="ðŸ‡·ðŸ‡º"
                class="btn btn-secondary"
              >
                Rusya
              </button>
              <button
                type="button"
                value="Azerbaycan"
                data-value="ðŸ‡¦ðŸ‡¿"
                class="btn btn-secondary"
              >
                Azerbaycan
              </button>
              <button
                type="button"
                value="TÃ¼rkmenistan"
                data-value="ðŸ‡¹ðŸ‡²"
                class="btn btn-secondary"
              >
                TÃ¼rkmenistan
              </button>
              <button
                type="button"
                value="GÃ¼rcistan"
                data-value="ðŸ‡¬ðŸ‡ª"
                class="btn btn-secondary"
              >
                GÃ¼rcistan
              </button>
              <button
                type="button"
                value="Ä°srail"
                data-value="ðŸ‡®ðŸ‡±"
                class="btn btn-secondary"
              >
                Ä°srail
              </button>
              <button
                type="button"
                value="Ã‡in"
                data-value="ðŸ‡¨ðŸ‡³"
                class="btn btn-secondary"
              >
                Ã‡in
              </button>
              <button
                type="button"
                value="Japonya"
                data-value="ðŸ‡¯ðŸ‡µ"
                class="btn btn-secondary"
              >
                Japonya
              </button>
              <button
                type="button"
                value="Pakistan"
                data-value="ðŸ‡µðŸ‡°"
                class="btn btn-secondary"
              >
                Pakistan
              </button>
              <button
                type="button"
                value="Tunus"
                data-value="ðŸ‡¹ðŸ‡³"
                class="btn btn-secondary"
              >
                Tunus
              </button>
              <button
                type="button"
                value="ÃœrdÃ¼n"
                data-value="ðŸ‡¯ðŸ‡´"
                class="btn btn-secondary"
              >
                ÃœrdÃ¼n
              </button>
              <button
                type="button"
                value="Kuveyt"
                data-value="ðŸ‡°ðŸ‡¼"
                class="btn btn-secondary"
              >
                Kuveyt
              </button>
              <button
                type="button"
                value="Suudi Arabistan"
                data-value="ðŸ‡¸ðŸ‡¦"
                class="btn btn-secondary"
              >
                Suudi Arabistan
              </button>
              <button
                type="button"
                value="Dubai"
                data-value="ðŸ‡¦ðŸ‡ª"
                class="btn btn-secondary"
              >
                Dubai
              </button>
            </div>
          </div>

          <!-- Messages -->
          <div
            class="messages col-12 col-md-5 d-flex flex-column align-items-start justify-content-center gap-3 px-4 p-md-0"
          ></div>

          <!-- Buttons 2 -->
          <div
            class="col-12 col-md-3 d-flex align-items-center justify-content-center"
          >
            <div
              class="flex-wrap justify-content-center col-12 gap-3 filter-buttons"
            >
              <button
                type="button"
                value="Katar"
                data-value="ðŸ‡¶ðŸ‡¦"
                class="btn btn-secondary"
              >
                Katar
              </button>
              <button
                type="button"
                value="Fas"
                data-value="ðŸ‡²ðŸ‡¦"
                class="btn btn-secondary"
              >
                Fas
              </button>
              <button
                type="button"
                value="MÄ±sÄ±r"
                data-value="ðŸ‡ªðŸ‡¬"
                class="btn btn-secondary"
              >
                MÄ±sÄ±r
              </button>
              <button
                type="button"
                value="Yemen"
                data-value="ðŸ‡¾ðŸ‡ª"
                class="btn btn-secondary"
              >
                Yemen
              </button>
              <button
                type="button"
                value="Danimarka"
                data-value="ðŸ‡©ðŸ‡°"
                class="btn btn-secondary"
              >
                Danimarka
              </button>
              <button
                type="button"
                value="Macaristan"
                data-value="ðŸ‡­ðŸ‡º"
                class="btn btn-secondary"
              >
                Macaristan
              </button>
              <button
                type="button"
                value="Portekiz"
                data-value="ðŸ‡µðŸ‡¹"
                class="btn btn-secondary"
              >
                Portekiz
              </button>
              <button
                type="button"
                value="Ä°talya"
                data-value="ðŸ‡®ðŸ‡¹"
                class="btn btn-secondary"
              >
                Ä°talya
              </button>
              <button
                type="button"
                value="BelÃ§ika"
                data-value="ðŸ‡§ðŸ‡ª"
                class="btn btn-secondary"
              >
                BelÃ§ika
              </button>
              <button
                type="button"
                value="Ä°spanya"
                data-value="ðŸ‡ªðŸ‡¸"
                class="btn btn-secondary"
              >
                Ä°spanya
              </button>
              <button
                type="button"
                value="Fransa"
                data-value="ðŸ‡«ðŸ‡·"
                class="btn btn-secondary"
              >
                Fransa
              </button>
              <button
                type="button"
                value="Almanya"
                data-value="ðŸ‡©ðŸ‡ª"
                class="btn btn-secondary"
              >
                Almanya
              </button>
              <button
                type="button"
                value="Romanya"
                data-value="ðŸ‡·ðŸ‡´"
                class="btn btn-secondary"
              >
                Romanya
              </button>
              <button
                type="button"
                value="Arnavutluk"
                data-value="ðŸ‡¦ðŸ‡±"
                class="btn btn-secondary"
              >
                Arnavutluk
              </button>
              <button
                type="button"
                value="Bulgaristan"
                data-value="ðŸ‡§ðŸ‡¬"
                class="btn btn-secondary"
              >
                Bulgaristan
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <script>
      moment.locale("tr");
      let searchText = "";
      let totalMessagesCount = 0;

      // Get Messages
      function updateMessages(searchText) {
        $.ajax({
          url: "/getMessages",
          method: "GET",
          dataType: "json",
          success: function (updateList) {
            const messageContainer = $(".messages");
            messageContainer.empty();

            totalMessagesCount = 0;

            updateList.forEach(function (message) {
              const messageText = message.messageText.toLowerCase();
              const buttonValue = searchText.toLowerCase();
              const buttonDataValue = $(`.btn[value="${searchText}"]`).data(
                "value"
              );
              if (
                buttonValue === "" ||
                messageText.includes(buttonValue) ||
                messageText.includes(buttonDataValue)
              ) {
                const card = `
              <div class="card border-dark mb-3 w-100">
                <div class="card-header">${moment
                  .unix(message.messageTimeStamp)
                  .fromNow()} paylaÅŸÄ±ldÄ±
                </div>
                <div class="card-body text-dark d-flex flex-column gap-2">
                  <h5 class="card-title">${message.messageText}</h5>
                  <p class="card-text d-flex gap-1"><i class="bi bi-telephone"></i>${
                    message.messageAuthor
                  }</p>
                </div>
              </div>
            `;
                messageContainer.append(card);
                totalMessagesCount++;
              }
            });
            $("#totalMessagesCount").text(totalMessagesCount);
            $("#selectFilter").text(searchText);
          },
          error: function (error) {
            console.error("Error fetching messages:", error);
          },
        });
      }

      // Button country filter and style class
      $(".btn").on("click", function () {
        const buttonText = $(this).val();
        searchText = buttonText === "hepsi" ? "" : buttonText;
        updateMessages(searchText);

        $(".btn").removeClass("btn-primary");
        $(".btn").addClass("btn-secondary");
        $(this).removeClass("btn-secondary");
        $(this).addClass("btn-primary");
      });

      // Option list filter
      $("#filterDropdown").on("change", function () {
        const selectedValue = $(this).val();
        searchText = selectedValue === "hepsi" ? "" : selectedValue;
        updateMessages(searchText);
      });

      // Input search
      $("#searchInput").on("input", function () {
        searchText = $(this).val();
        updateMessages(searchText);
      });

      // DOM updateMessages
      document.addEventListener("DOMContentLoaded", () => {
        updateMessages(searchText);
      });

      // 3 seconds updateMessages
      setInterval(function () {
        updateMessages(searchText);
      }, 3000);
    </script>
  </body>
</html>
